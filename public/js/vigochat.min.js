function escapeHtml(e){var a=document.createElement("div");return a.appendChild(document.createTextNode(e)),a.innerHTML}function unescapeHtml(e){var a=document.createElement("div");a.innerHTML=e;var t=a.childNodes[0];return t?t.nodeValue:""}$(document).ready(function(){$.fn.vigoChat=function(e){var a=null,t=$(this),n=location.origin.replace(/^http/,"ws"),s=new WebSocket(n);t.hide();var i=document.createElement("input");$(i).attr("type","text");var d=document.createElement("div"),o=document.createElement("div");s.onopen=function(e){$("body").append(d),$(d).dialog({width:"auto",height:"auto",modal:!0,resizable:!1,title:"Enter Chat Handle",buttons:{"Enter Chatroom":function(){var e;""!=$(i).val()&&(a=$(i).val(),$(this).dialog("close"),t.fadeIn(),e={type:"set-handle-request",handle:a},s.send(JSON.stringify(e)),$(o).addClass("vigochat_active_users_display"),$(o).css({position:"absolute",left:parseInt(t.css("width"))+20+"px",height:parseInt(t.css("height"))-150+"px",top:"20px"}),t.append(o),s.send(JSON.stringify({type:"user-list-request"})))}}}).append(i)};var r=setInterval(function(){1===s.readyState&&(clearInterval(r),setInterval(function(){s.send(JSON.stringify({type:"ping"}))},3e3))},5);s.onerror=function(e){console.log(e),connected=!1},s.onclose=function(){connected=!1},$(this).addClass("vigochat_wrapper"),e&&this.css({width:e});var l=document.createElement("div");$(l).addClass("vigochat_message_display"),this.append(l);var c=document.createElement("textarea");this.append(c),$(c).addClass("vigochat_message_input"),$(c).width(Number(parseInt(t.css("width"))-parseInt(t.css("padding"))/2-64)+"px");var p=document.createElement("input");$(p).attr("type","button"),$(p).attr("value","Send"),$(p).addClass("vigochat_message_send_button"),this.append(p),$(this).draggable().bind("click",function(){$(c).focus()});var g=[];function v(e){for(var a=0;a<g.length;a++){var t=g[a];if(null!=t&&t.attr("handle")==e)return!0}return!1}function h(e){for(var a=0;a<g.length;a++){var t=g[a];null!=t&&t.attr("handle")==e&&g[a].fadeIn()}}s.onmessage=function(e){var n=JSON.parse(e.data);if("message"==n.type){var s=document.createElement("div");$(s).addClass("vigochat_incoming_message"),$(s).append("<b>"+n.from+"</b>: "+n.message),$(l).append(s),$(l).append("<br class='vigochat_message_break'/>"),$(l).animate({scrollTop:$(l).get(0).scrollHeight},300)}if("private-message"==n.type)if(v(n.from)){h(n.from);for(var i=0;i<g.length;i++){var r=g[i];if($(r).attr("handle")==n.from){var c=$(r).find(".vigochat_private_message_window_message_display");s=document.createElement("div");$(s).addClass("vigochat_incoming_message"),$(s).append("<b>"+n.from+"</b>: "+escapeHtml(n.message)),$(c).append(s),$(c).append("<br class='vigochat_message_break'/>"),$(c).animate({scrollTop:$(c).get(0).scrollHeight},300)}}}else u(n.from),setTimeout(function(){for(var e=0;e<g.length;e++){var a=g[e];if($(a).attr("handle")==n.from){var t=$(a).find(".vigochat_private_message_window_message_display"),s=document.createElement("div");$(s).addClass("vigochat_incoming_message"),$(s).append("<b>"+n.from+"</b>: "+escapeHtml(n.message)),$(t).append(s),$(t).append("<br class='vigochat_message_break'/>"),$(t).animate({scrollTop:$(t).get(0).scrollHeight},300)}}},10);"set-handle-response"==n.type&&("handle-unavailable"==n.response&&(t.hide(),alert("The handle you entered is not available, please enter another."),$(d).dialog("open")));if("user-list-response"==n.type){$(o).html("");var p=n.userlist;for(var m in p)if(p[m]!=a){var f=document.createElement("div");$(f).attr("handle",p[m]),$(f).addClass("vigochat_connected_user"),$(f).append("👤 ");var _=p[m];_.length>9&&(_=_.substring(0,6)+"..."),$(f).append(_),$(o).append(f),$(f).click(function(){u($(this).attr("handle"))})}}"user-disconnected"==n.type&&function(e){for(var a=0;a<g.length;a++){var t=g[a];null!=t&&t.attr("handle")==e&&(g[a].remove(),g[a]=null,alert(e+" has disconnected from the chat."))}}(n.handle)};var m="😀 😇 😎 😁 😐 😑 😕 😗 😙 😛 😟 😦 😧 😬 😮 😯 😴 😶 😂 😃 😄 😅 😆 😉 😊 😋 😌 😍 😏 😒 😓 😔 😖 😘 😚 😜 😝 😞 😠 😡 😢 😣 😤 😥 😨 😩 😪 😫 😭 😰 😱 😲 😳 😵 😷 🤓 🤪 🤮 😸 😹 😺 😻 😼 😽 😾 😿 🙀 🙅 🙆 🙇 🙈 🙉 🙊 🙋 🙌 🙍 🙎 🙏 ⌚ ⌛ ♻ 🍟 🍕 🍔 🍌 🍄 🍀 🌽 🌹 🍭 🍪 🍰 🍳 🍺 🍻 🎁 🎂 🎃 🎄 🎈 🎉 🎒 🎓 🎤 🎥 🎧 🎨 🎩 🎬 🎭 🎮 🎵 🎸 🎹 🎺 🎻 🏆 👀 👂 👃 👄 👅 👆 👇 👈 👉 👊 👋 👌 👍 👎 👏 👐 👑 👓 👔 👕 👖 👗 👘 👙 👚 👛 👜 👝 👞 👟 👠 👡 👢 👣 👤 👦 👧 👨 👩 👪 👫 👮 👯 👰 👱 👴 👵 👶 👷 👸 👹 👺 👻 👼 👽 👾 👿 💀 💁 💂 💃 💄 💅 💆 💇 💉 💊 💋 💌 💍 💎 💏 💑 💐 💒 💓 💔 💕 💖 💗 💘 💙 💚 💛 💜 💝 💞 💟 💠 💡 💢 💣 💤 💥 💦 💧 💨 💩 💪 💬 💯 💰 💲 💳 💵 💸 💻 💽 💾 💿 📀 📁 📂 📃 📅 📌 📎";function u(e){if("⏳"!=e)if(v(e))h(e);else{var t=document.createElement("div");$(t).attr("handle",e),$(t).css("position","absolute"),$(t).css("width","290px"),$(t).css("height","305px"),$(t).css("top",$(window).height()/2-$(t).height()/2),$(t).css("left",$(window).width()/2-$(t).width()/2),$(t).addClass("vigochat_private_message_window");var n=document.createElement("div");$(n).addClass("vigochat_private_message_window_top_bar");var i=document.createElement("div");$(i).addClass("vigochat_private_message_window_close_button"),$(i).append("X"),$(i).click(function(){$(i).parent().parent().parent().fadeOut()});var d=document.createElement("div");$(d).addClass("vigochat_private_message_window_title_bar"),$(d).append("&nbsp;Private Message - "+e),$(n).append(d),$(d).append(i),$(t).append(n);var o=document.createElement("div");$(o).addClass("vigochat_private_message_window_message_display"),$(t).append(o);var r=document.createElement("div");$(r).addClass("vigochat_private_message_window_message_input_wrapper");var l=document.createElement("textarea");$(l).addClass("vigochat_private_message_window_message_input"),$(r).append(l),$(t).append(r);var c=document.createElement("div");$(c).addClass("vigochat_private_message_window_emojis"),$(c).css("margin-top","5px"),$(c).css("width","90%"),$(t).append(c);for(var p=m.split(" "),u=[],f=0;f<p.length;f++){var _=document.createElement("div");$(_).addClass("vigochat_emoji_button"),$(_).attr("value",p[f]),$(_).text(p[f]),u.push(_),$(c).append(_),$(_).click(function(){var e=$(l).get(0).selectionStart,a=$(l).val().substring(0,e),t=$(l).val().substring(e++,$(l).val().length),n=a+$(this).attr("value")+t.replace(/\s*$/,"");$(l).val(n),$(l).focus(),$(l).get(0).setSelectionRange($(l).val().length,$(l).val().length)})}var b=document.createElement("button");$(b).append("😀"),$(b).css("position","relative"),$(b).css("left","5px"),$(b).css("top","5px"),$(b).hover(function(){$(this).css("cursor","pointer")}),$(t).append(b),$(b).click(function(){var e=$(c).css("display");"block"==e&&($(c).children().hide(),$(c).animate({width:"-=95px"},function(){$(c).hide()})),"none"==e&&($(c).fadeIn(),$(c).animate({width:"+=95px",height:"285px"},function(){$(c).children().fadeIn()}))}),$(t).draggable().bind("click",function(){$(l).focus()}),$(l).on("keyup",function(e){var n=0===$(l).val().trim().length;if(13===e.keyCode&&!1===n){var i={type:"message",recipient:$(t).attr("handle"),handle:a,message:$(l).val()},d=document.createElement("div");$(d).hide(),$(d).addClass("vigochat_outgoing_message"),$(d).append("<b>"+i.handle+"</b>: "+escapeHtml(i.message)),$(o).append(d),$(d).fadeIn(),$(o).append("<br class='vigochat_message_break'/>"),$(l).val(""),s.send(JSON.stringify(i)),$(this).trigger("sendMessage",i),$(o).animate({scrollTop:$(o).get(0).scrollHeight},300)}else!0===n&&($(l).focus(),$(l).get(0).setSelectionRange(0,0))}),$(t).hide(),$("body").append(t),$(t).draggable(),$(t).fadeIn(),g.push($(t))}}$(p).click(function(){if(0!=$(c).val().length){var e={type:"message",recipient:"all",handle:a,message:escapeHtml($(c).val())},t=document.createElement("div");$(t).hide(),$(t).addClass("vigochat_outgoing_message"),$(t).append("<b>"+e.handle+"</b>: "+e.message),$(t).wrap('<div style="width: 100%;"></div>'),$(l).append(t),$(t).fadeIn(),$(l).append("<br class='vigochat_message_break'/>"),$(c).val(""),s.send(JSON.stringify(e)),$(this).trigger("sendMessage",e),$(l).animate({scrollTop:$(l).get(0).scrollHeight},300)}}),$(c).on("keyup",function(e){var t=0===$(c).val().trim().length;if(13===e.keyCode&&!1===t){var n={type:"message",recipient:"all",handle:a,message:escapeHtml($(c).val())},i=document.createElement("div");$(i).hide(),$(i).addClass("vigochat_outgoing_message"),$(i).append("<b>"+n.handle+"</b>: "+n.message),$(l).append(i),$(i).fadeIn(),$(l).append("<br class='vigochat_message_break'/>"),$(c).val(""),s.send(JSON.stringify(n)),$(this).trigger("sendMessage",n),$(l).animate({scrollTop:$(l).get(0).scrollHeight},300)}else!0===t&&($(c).focus(),$(c).get(0).setSelectionRange(0,0))});var f=document.createElement("div");$(f).addClass("vigochat_emojis"),$(this).append(f);for(var _=m.split(" "),b=[],w=0;w<_.length;w++){var y="<div index='"+w+"' class='vigochat_emoji_button' value='"+_[w]+"'>"+_[w]+"</div>";b.push(y),$(f).append(y)}$(".vigochat_emoji_button").click(function(){var e=$(c).get(0).selectionStart,a=$(c).val().substring(0,e),t=$(c).val().substring(e++,$(c).val().length),n=a+$(this).attr("value")+t.replace(/\s*$/,"");$(c).val(n),$(c).focus(),$(c).get(0).setSelectionRange(e+1,e+1)});var C=document.createElement("button");$(C).append("😀"),$(C).addClass("vigochat_show_emoji_button"),$(this).append(C);var E=!1;$(C).click(function(){0==E&&("block"==$(".vigochat_emojis").css("display")?(E=!0,$(f).animate({height:"-=100px"},function(){$(this).fadeOut(),E=!1})):"none"==$(".vigochat_emojis").css("display")&&(E=!0,$(f).fadeIn(100,function(){$(this).animate({height:"+=100px"},function(){E=!1})})))});var k=document.createElement("button");$(k).addClass("vigochat_user_list_button"),$(k).append("👥");var x=!1;$(k).click(function(){0==x&&("block"==$(o).css("display")?(x=!0,$(o).children().length>0?$(o).children().fadeOut(10,function(){$(o).animate({width:"-=150px"},function(){$(o).fadeOut(),x=!1})}):$(o).animate({width:"-=150px"},function(){$(o).fadeOut(),x=!1})):(x=!0,$(o).fadeIn(),$(o).animate({width:"+=150px"},300,function(){$(o).children().fadeIn(),x=!1})))}),$(this).append(k),$(c).focus()}});